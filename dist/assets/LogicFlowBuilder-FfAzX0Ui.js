import{r as d,ag as k,ah as S,j as e,J as C,S as E,ai as h,aa as b,L as M,M as $,aj as O}from"./index-Br2PlERp.js";import"https://esm.sh/octokit@4.0.2";import{F}from"./taxonomyService-3ceLMdQG.js";const P=new Map(h.map(t=>[t.id,t])),R=new Map(F.map(t=>[t.id,t])),G=({feature:t,onDragStart:n})=>e.jsxs("div",{draggable:!0,onDragStart:o=>n(o,t.id),className:"p-3 rounded-md bg-gray-50 border border-border flex items-center gap-3 cursor-grab hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"text-primary flex-shrink-0",children:t.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm text-text-primary",children:t.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:t.category})]})]}),L=({node:t,feature:n,index:o,onDragStart:i,onDragEnter:x,onDragEnd:g,onRemove:f})=>e.jsxs("div",{draggable:!0,onDragStart:i,onDragEnter:x,onDragEnd:g,onDragOver:u=>u.preventDefault(),className:"w-full bg-surface rounded-lg shadow-md border-2 border-border cursor-grab active:cursor-grabbing flex items-center p-3 gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold text-lg",children:o+1}),e.jsx("div",{className:"w-6 h-6 text-text-secondary",children:n.icon}),e.jsx("span",{className:"flex-grow font-semibold truncate text-text-primary",children:n.name}),e.jsx("button",{onClick:f,className:"p-1 text-text-secondary hover:text-red-500",children:e.jsx(b,{})}),e.jsx("div",{className:"p-1 text-text-secondary cursor-grab",children:e.jsx(O,{})})]}),B=()=>{const[t,n]=d.useState([]),[o,i]=d.useState(""),[x,g]=d.useState(!1),[f,u]=d.useState(!1),m=d.useRef(null),p=d.useRef(null),j=d.useCallback(async()=>{g(!0),i("");const r=t.map((s,a)=>{const l=R.get(s.featureId);if(!l)return`Step ${a+1}: Unknown tool with ID ${s.featureId}`;const c=k[s.featureId]||"unknownTool";return`Step ${a+1}: Execute the '${l.name}' tool (function: ${c}). Description: ${l.description}. Inputs: ${l.inputs}.`}).join(`
`);try{const s=await S(r);i(s)}catch(s){i(`// Error generating code: ${s instanceof Error?s.message:"Unknown error"}`)}finally{g(!1)}},[t]),v=(r,s)=>{r.dataTransfer.setData("application/json",JSON.stringify({featureId:s}))},N=r=>{r.preventDefault(),u(!1);const s=r.dataTransfer.getData("application/json");if(!s)return;const{featureId:a}=JSON.parse(s),l={id:Date.now(),featureId:a};n(c=>[...c,l])},y=r=>{m.current=r},w=r=>{p.current=r},D=()=>{if(m.current&&p.current&&m.current.id!==p.current.id){const r=[...t],s=t.findIndex(c=>c.id===m.current.id),a=t.findIndex(c=>c.id===p.current.id),[l]=r.splice(s,1);r.splice(a,0,l),n(r)}m.current=null,p.current=null},I=r=>{n(s=>s.filter(a=>a.id!==r))};return e.jsxs("div",{className:"h-full flex flex-col p-4 sm:p-6 lg:p-8 text-text-primary",children:[e.jsxs("header",{className:"mb-6 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[e.jsx(C,{}),e.jsx("span",{className:"ml-3",children:"Logic Flow Builder"})]}),e.jsx("p",{className:"text-text-secondary mt-1",children:"Visually build application logic flows and generate pipeline code."})]}),e.jsxs("button",{onClick:j,disabled:x||t.length===0,className:"btn-primary flex items-center gap-2 px-4 py-2",children:[e.jsx(E,{})," ",x?"Generating...":"Generate Code"]})]}),e.jsxs("div",{className:"flex-grow flex gap-6 min-h-0",children:[e.jsxs("aside",{className:"w-72 flex-shrink-0 bg-surface border border-border p-4 rounded-lg flex flex-col",children:[e.jsx("h3",{className:"font-bold mb-3 text-lg",children:"Features"}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-3 pr-2",children:h.map(r=>e.jsx(G,{feature:r,onDragStart:v},r.id))})]}),e.jsx("main",{className:`flex-grow relative bg-background border-2 ${f?"border-primary":"border-dashed border-border"} rounded-lg overflow-y-auto p-4 transition-colors`,onDrop:N,onDragOver:r=>{r.preventDefault(),u(!0)},onDragLeave:()=>u(!1),children:t.length===0?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-text-secondary",children:e.jsx("p",{children:"Drag features here to build your pipeline"})}):e.jsx("div",{className:"space-y-2 max-w-lg mx-auto",children:t.map((r,s)=>{const a=P.get(r.featureId);return a?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(L,{node:r,feature:a,index:s,onDragStart:()=>y(r),onDragEnter:()=>w(r),onDragEnd:D,onRemove:()=>I(r.id)}),s<t.length-1&&e.jsx("div",{className:"w-0.5 h-6 bg-border my-1"})]},r.id):null})})})]}),(x||o)&&e.jsx("div",{className:"fixed inset-0 bg-gray-900/80 backdrop-blur-sm z-50 flex items-center justify-center",onClick:()=>i(""),children:e.jsxs("div",{className:"w-full max-w-3xl h-3/4 bg-surface border border-border rounded-lg shadow-2xl p-6 flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Generated Pipeline Code"}),e.jsx("button",{onClick:()=>i(""),className:"p-1 text-text-secondary hover:text-text-primary",children:e.jsx(b,{})})]}),e.jsx("div",{className:"flex-grow bg-background border border-border rounded-md overflow-auto",children:x&&!o?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(M,{})}):e.jsx($,{content:"```javascript\n"+o.replace(/^```(javascript)?|```$/g,"")+"\n```"})})]})})]})};export{B as LogicFlowBuilder};
