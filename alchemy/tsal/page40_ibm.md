# TSAL Immutable Build Manifest (IBM) Specification

**Document ID:** TSAL-SPEC-IBM-v2.1
**Status:** Final
**Classification:** TSAL Confidential

---

## 1. Introduction

The TSAL Immutable Build Manifest (IBM) is a cryptographically sealed document that provides a verifiable and tamper-evident record of a software artifact's compilation and packaging process. In an environment where supply-chain integrity is paramount, the IBM serves as a foundational "birth certificate" for every component within the TSAL ecosystem.

Its primary purpose is to guarantee that a given software artifact is the authentic, unmodified output of a specific, known build process, originating from an exact version of the source code. This allows any consumer of the artifact—be it an automated deployment system, a security auditor, or another developer—to independently verify its provenance and integrity before execution or integration.

The IBM is designed to be a self-contained, machine-readable proof, resistant to forgery and unauthorized alteration.

## 2. Core Concepts

### 2.1. The Hermetic Build Environment

Every TSAL build is executed within a "hermetic" or sealed environment. This environment ensures that the build process has no access to external network resources and relies solely on a declared, version-pinned set of dependencies. The IBM captures the complete state of this environment, making the build reproducible and auditable.

### 2.2. Cryptographic Sealing

The immutability of the manifest is achieved through strong cryptographic principles. The entire manifest, once generated, is serialized into a canonical format and then digitally signed using the TSAL Build Authority's private key. Any modification to the manifest, however minor, will invalidate this signature.

### 2.3. Verifiable Provenance

The IBM establishes a verifiable chain of trust from the source code commit to the final binary artifact. It acts as the definitive record of *what* was built, *how* it was built, and *what* it produced.

## 3. Manifest Structure

The IBM is a structured data object, typically serialized as JSON. It contains the following primary sections:

### 3.1. `header`
Metadata describing the manifest itself.

-   `specVersion` (String): The version of the IBM specification (e.g., "2.1").
-   `buildID` (String): A unique, non-sequential identifier for the build instance.
-   `timestamp` (String): The UTC timestamp (ISO 8601 format) when the manifest was sealed.

### 3.2. `provenance`
Information describing the inputs and environment of the build process.

-   `source`
    -   `type` (String): The version control system used (e.g., "git").
    -   `repository` (String): The canonical URL of the source code repository.
    -   `commitHash` (String): The full SHA-1 or SHA-256 commit hash of the source code revision.
-   `builder`
    -   `id` (String): The unique identifier of the build agent or system.
    -   `publicKey` (String): The public key corresponding to the build agent's identity.
-   `environment`
    -   `platform` (String): A descriptor for the OS and architecture (e.g., "linux/amd64").
    -   `toolchain` (Array of Objects): A list of compilers, linkers, and essential tools used.
        -   `name` (String): Name of the tool (e.g., "gcc").
        -   `version` (String): Version of the tool.
        -   `hash` (String): A SHA-256 hash of the tool's binary.
    -   `dependencies` (Array of Objects): A list of all third-party libraries and dependencies.
        -   `name` (String): Name of the dependency.
        -   `version` (String): Exact version of the dependency.
        -   `hash` (String): A SHA-256 hash of the dependency artifact.

### 3.3. `artifacts`
An exhaustive list of all files generated by the build process.

-   (Array of Objects)
    -   `name` (String): The path of the artifact relative to the build root.
    -   `hash` (String): The SHA-256 hash of the artifact's content.
    -   `mimeType` (String): The content type of the file (e.g., "application/x-executable").

### 3.4. `signatureBlock`
The cryptographic seal that guarantees the integrity of the manifest.

-   `signerID` (String): The identifier for the TSAL Build Authority's signing key.
-   `algorithm` (String): The signing algorithm used (e.g., "ECDSA-P384-SHA384").
-   `signature` (String): The Base64-encoded digital signature of the canonicalized manifest content (excluding the `signatureBlock` itself).

## 4. Process Flow

### 4.1. Generation

1.  A build is initiated within the hermetic environment.
2.  Upon successful completion, the build agent gathers all provenance data and calculates the hashes for all source dependencies and output artifacts.
3.  The agent assembles the `header`, `provenance`, and `artifacts` sections of the manifest.
4.  The assembled data is converted to a canonical JSON string (keys sorted, no insignificant whitespace).
5.  A SHA-384 hash of this canonical string is calculated.
6.  The hash is signed using the TSAL Build Authority's private key.
7.  The `signatureBlock` is populated and appended to the manifest.
8.  The final IBM is stored and distributed alongside the build artifacts.

### 4.2. Verification

1.  A client retrieves a build artifact and its corresponding IBM.
2.  The client separates the `signatureBlock` from the rest of the manifest.
3.  The client re-creates the canonical JSON string from the manifest data.
4.  Using the trusted TSAL Build Authority's public key, the client verifies the signature against the hash of the canonical string. **If verification fails, the process stops and the manifest is rejected.**
5.  If the signature is valid, the client calculates the SHA-256 hash of its local copy of the build artifact.
6.  The client compares its calculated hash against the hash listed for that artifact within the now-trusted manifest.
7.  A match provides cryptographic certainty that the local artifact is authentic and has not been tampered with since its creation.